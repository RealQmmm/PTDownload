# æ•°æ®åº“å¤–éƒ¨æŒ‚è½½ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

PTDownload ç°åœ¨æ”¯æŒä¸¤ç§æ•°æ®åº“å­˜å‚¨æ–¹å¼ï¼š

1. **å†…ç½®æ•°æ®åº“**ï¼ˆé»˜è®¤ï¼‰ï¼šæ•°æ®å­˜å‚¨åœ¨å®¹å™¨å†…çš„ `/data` ç›®å½•ï¼Œé€šè¿‡ `./data` æŒ‚è½½åˆ°å®¿ä¸»æœº
2. **å¤–éƒ¨æ•°æ®åº“**ï¼šæ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·æŒ‡å®šçš„å¤–éƒ¨è·¯å¾„ï¼Œä¾¿äºæ•°æ®è¿ç§»å’Œå¤‡ä»½

> ğŸ’¡ **å·²æœ‰æ•°æ®éœ€è¦è¿ç§»ï¼Ÿ** è¯·æŸ¥çœ‹ [ä»å†…ç½®æ•°æ®åº“è¿ç§»åˆ°å¤–éƒ¨æ•°æ®åº“æŒ‡å—](migrate-to-external-db.md)

## ä½¿ç”¨åœºæ™¯

### å†…ç½®æ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰
- é€‚åˆï¼šå¿«é€Ÿéƒ¨ç½²ã€å•æœºä½¿ç”¨
- ä¼˜ç‚¹ï¼šé…ç½®ç®€å•ï¼Œå¼€ç®±å³ç”¨
- ç¼ºç‚¹ï¼šè¿ç§»é•œåƒæ—¶éœ€è¦å¤‡ä»½å’Œå¯¼å…¥è®¾ç½®

### å¤–éƒ¨æ•°æ®åº“
- é€‚åˆï¼šéœ€è¦é¢‘ç¹è¿ç§»ã€å¤šç¯å¢ƒéƒ¨ç½²ã€æ•°æ®æŒä¹…åŒ–è¦æ±‚é«˜
- ä¼˜ç‚¹ï¼šè¿ç§»æ—¶æ— éœ€å¤‡ä»½å¯¼å…¥ï¼Œç›´æ¥æŒ‚è½½å³å¯
- ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–é…ç½®

## é…ç½®æ–¹æ³•

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å†…ç½®æ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰

æ— éœ€ä»»ä½•é…ç½®ï¼Œç›´æ¥è¿è¡Œï¼š

```bash
docker-compose up -d
```

æ•°æ®ä¼šå­˜å‚¨åœ¨ `./data/ptdownload.db`

### æ–¹å¼äºŒï¼šä½¿ç”¨å¤–éƒ¨æ•°æ®åº“

#### 1. å‡†å¤‡å¤–éƒ¨æ•°æ®åº“ç›®å½•

åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºæ•°æ®åº“å­˜å‚¨ç›®å½•ï¼š

```bash
mkdir -p /path/to/your/database
```

#### 2. ä¿®æ”¹ docker-compose.yml

ç¼–è¾‘ `docker-compose.yml`ï¼Œæ‰¾åˆ° `volumes` éƒ¨åˆ†ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹å¤–éƒ¨æ•°æ®åº“æŒ‚è½½è·¯å¾„ï¼š

```yaml
volumes:
  # å†…ç½®æ•°æ®ç›®å½•ï¼ˆé»˜è®¤ï¼‰
  - ./data:/data
  # å¤–éƒ¨æ•°æ®åº“æŒ‚è½½ï¼ˆå¯é€‰ï¼‰
  # å–æ¶ˆä¸‹é¢çš„æ³¨é‡Šï¼Œå¹¶ä¿®æ”¹ä¸ºä½ çš„å®é™…è·¯å¾„
  - /path/to/your/database:/external_db  # ä¿®æ”¹è¿™é‡Œ
```

#### 3. ä¿®æ”¹ç¯å¢ƒå˜é‡

åœ¨ `docker-compose.yml` çš„ `environment` éƒ¨åˆ†ï¼Œä¿®æ”¹ï¼š

```yaml
environment:
  - USE_EXTERNAL_DB=true  # æ”¹ä¸º true
  - EXTERNAL_DB_PATH=/external_db/ptdownload.db  # å®¹å™¨å†…è·¯å¾„ï¼Œé€šå¸¸ä¸éœ€è¦æ”¹
```

#### 4. å¯åŠ¨å®¹å™¨

```bash
docker-compose up -d --build
```

## é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä½¿ç”¨å®¿ä¸»æœºçš„ `/home/user/ptdb` ä½œä¸ºæ•°æ®åº“ç›®å½•

**docker-compose.yml**:
```yaml
volumes:
  - ./data:/data
  - /home/user/ptdb:/external_db

environment:
  - USE_EXTERNAL_DB=true
  - EXTERNAL_DB_PATH=/external_db/ptdownload.db
```

### ç¤ºä¾‹ 2ï¼šä½¿ç”¨ NAS æŒ‚è½½ç›®å½•

å‡è®¾ä½ çš„ NAS æŒ‚è½½åœ¨ `/mnt/nas/ptdownload`ï¼š

**docker-compose.yml**:
```yaml
volumes:
  - ./data:/data
  - /mnt/nas/ptdownload:/external_db

environment:
  - USE_EXTERNAL_DB=true
  - EXTERNAL_DB_PATH=/external_db/ptdownload.db
```

## æ•°æ®è¿ç§»

### ä»å†…ç½®æ•°æ®åº“è¿ç§»åˆ°å¤–éƒ¨æ•°æ®åº“

1. åœæ­¢å®¹å™¨ï¼š
   ```bash
   docker-compose down
   ```

2. å¤åˆ¶æ•°æ®åº“æ–‡ä»¶åˆ°å¤–éƒ¨ç›®å½•ï¼š
   ```bash
   cp ./data/ptdownload.db /path/to/your/database/
   ```

3. ä¿®æ”¹ `docker-compose.yml` é…ç½®ï¼ˆå‚è€ƒä¸Šé¢çš„é…ç½®æ–¹æ³•ï¼‰

4. å¯åŠ¨å®¹å™¨ï¼š
   ```bash
   docker-compose up -d
   ```

### ä»å¤–éƒ¨æ•°æ®åº“è¿ç§»åˆ°å†…ç½®æ•°æ®åº“

1. åœæ­¢å®¹å™¨ï¼š
   ```bash
   docker-compose down
   ```

2. å¤åˆ¶æ•°æ®åº“æ–‡ä»¶åˆ°å†…ç½®ç›®å½•ï¼š
   ```bash
   cp /path/to/your/database/ptdownload.db ./data/
   ```

3. ä¿®æ”¹ `docker-compose.yml`ï¼Œè®¾ç½® `USE_EXTERNAL_DB=false`

4. å¯åŠ¨å®¹å™¨ï¼š
   ```bash
   docker-compose up -d
   ```

### è·¨æœåŠ¡å™¨è¿ç§»ï¼ˆä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼‰

1. åœ¨æ—§æœåŠ¡å™¨ä¸Šåœæ­¢å®¹å™¨ï¼š
   ```bash
   docker-compose down
   ```

2. å¤åˆ¶å¤–éƒ¨æ•°æ®åº“æ–‡ä»¶åˆ°æ–°æœåŠ¡å™¨ï¼š
   ```bash
   scp /path/to/database/ptdownload.db user@new-server:/path/to/database/
   ```

3. åœ¨æ–°æœåŠ¡å™¨ä¸Šé…ç½®ç›¸åŒçš„ `docker-compose.yml`

4. å¯åŠ¨å®¹å™¨ï¼š
   ```bash
   docker-compose up -d
   ```

## éªŒè¯é…ç½®

å¯åŠ¨å®¹å™¨åï¼ŒæŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ•°æ®åº“è·¯å¾„ï¼š

```bash
docker logs pt-app | grep Database
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š

- å†…ç½®æ•°æ®åº“ï¼š`[Database] Using INTERNAL database at: /data/ptdownload.db`
- å¤–éƒ¨æ•°æ®åº“ï¼š`[Database] Using EXTERNAL database at: /external_db/ptdownload.db`

## å¸¸è§é—®é¢˜

### Q: å¤–éƒ¨æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ
A: ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ•°æ®åº“æ–‡ä»¶å’Œè¡¨ç»“æ„ã€‚

### Q: å¯ä»¥åŒæ—¶ä½¿ç”¨å†…ç½®å’Œå¤–éƒ¨æ•°æ®åº“å—ï¼Ÿ
A: ä¸å¯ä»¥ï¼Œåªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ç§æ–¹å¼ã€‚

### Q: ä¿®æ”¹é…ç½®åéœ€è¦é‡æ–°æ„å»ºé•œåƒå—ï¼Ÿ
A: ä¸éœ€è¦ï¼Œåªéœ€è¦é‡å¯å®¹å™¨å³å¯ï¼š`docker-compose restart`

### Q: å¤–éƒ¨æ•°æ®åº“è·¯å¾„æƒé™é—®é¢˜ï¼Ÿ
A: ç¡®ä¿å®¹å™¨æœ‰è¯»å†™æƒé™ï¼š
```bash
chmod -R 755 /path/to/your/database
```

## æ¨èå®è·µ

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå»ºè®®ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼Œä¾¿äºå¤‡ä»½å’Œè¿ç§»
2. **å¼€å‘æµ‹è¯•**ï¼šä½¿ç”¨å†…ç½®æ•°æ®åº“å³å¯
3. **å®šæœŸå¤‡ä»½**ï¼šæ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
4. **NAS å­˜å‚¨**ï¼šå¦‚æœæœ‰ NASï¼Œå¼ºçƒˆæ¨èå°†æ•°æ®åº“å­˜å‚¨åœ¨ NAS ä¸Š
