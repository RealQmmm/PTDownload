# PT Download Manager - 优化与功能路线图

> 生成日期: 2026-01-06  
> 本文档整理了项目的优化建议和值得追加的功能

---

## 🔧 优化建议

### 1. 性能与体验优化

| 优化点 | 当前情况 | 建议 |
|--------|----------|------|
| **数据缓存** | 每次加载都从后端获取 | 前端添加 React Query 或 SWR 实现智能缓存 + 乐观更新 |
| **搜索防抖** | 可能每次按键都触发 | 搜索输入添加 debounce（300-500ms） |
| **大列表虚拟化** | 种子列表可能很长 | 使用 react-window 虚拟化渲染长列表 |
| **错误边界** | 单个组件崩溃影响全局 | 添加 Error Boundary 组件隔离错误 |

### 2. 代码质量优化

- ✅ **TypeScript 迁移**：逐步将关键模块迁移到 TypeScript，提升代码可维护性
- ✅ **API 统一封装**：创建统一的 `api.js` 层，处理错误、重试、loading 状态
- ✅ **日志规范化**：后端日志使用 winston 或 pino，支持日志级别和文件轮转

---

## 🆕 值得追加的功能

### 🎯 高优先级（核心价值）

#### 1. 站点数据统计页面

```
功能描述：
- 每个站点的上传/下载量趋势图
- 本周/本月各站点贡献排行
- 分享率变化曲线
- 积分/魔力值追踪（如果API支持）

技术要点：
- 使用 Chart.js 或 Recharts 绑制图表
- 后端定时记录 site_daily_stats 数据
- 支持时间范围筛选（7天/30天/全部）
```

#### 2. 智能辅种功能

```
功能描述：
- 连接 IYUU 或自建辅种API
- 自动识别已有种子，在其他站点寻找相同资源
- 一键添加辅种任务

技术要点：
- 集成 IYUU API（https://api.iyuu.cn）
- 按 info_hash 匹配跨站资源
- 批量添加种子到下载器
```

#### 3. 种子生命周期管理

```
功能描述：
- 种子状态时间线（添加 → 下载中 → 做种 → 清理）
- 自定义清理规则（按站点、按分类、按体积）
- 保种目标设置（例如：达到 3.0 分享率后停止做种）

技术要点：
- 扩展 task_history 表，记录状态变更
- 灵活的规则引擎（JSON 配置）
- 定时任务检查并执行清理
```

#### 4. 移动端适配 / PWA

```
功能描述：
- 响应式布局优化（当前可能只针对桌面）
- PWA 支持（离线缓存、添加到主屏幕）
- 关键操作的移动端快捷入口

技术要点：
- 添加 manifest.json 和 service worker
- 使用 workbox 实现离线缓存策略
- 优化触摸交互体验
```

---

### 📊 中优先级（增强体验）

#### 5. 通知增强

```
功能描述：
- 支持更多通知渠道：Telegram Bot、邮件、企业微信
- 分级通知：重要事件 vs 日常通知
- 每日摘要报告（今日下载 X 个，上传 Y GB）

技术要点：
- 通知渠道插件化设计
- 通知队列 + 批量发送
- 定时摘要任务
```

#### 6. 搜索增强

```
功能描述：
- 收藏搜索结果（稀后下载）
- 搜索历史记录
- 多站点聚合搜索（同时搜索多个站点，合并结果）
- 预设搜索模板（例如："4K 电影 > 50GB"）

技术要点：
- 新增 search_favorites 表
- 并发请求多站点 + 结果合并排序
- 搜索模板存储为 JSON
```

#### 7. 追剧功能增强

```
功能描述：
- 播出日历视图（显示即将更新的剧集）
- TMDB 评分显示
- 剧集完结自动停用任务
- 追剧进度追踪（已看 vs 已下载）

技术要点：
- 调用 TMDB API 获取播出日期
- 定期检查剧集是否完结
- 新增 watch_progress 字段
```

#### 8. 标签/分类系统

```
功能描述：
- 为种子添加自定义标签
- 按标签筛选和批量操作
- 智能自动标签（根据文件名识别类型）

技术要点：
- 新增 tags 和 torrent_tags 关联表
- 前端 Tag 组件 + 筛选器
- 正则匹配自动打标签
```

---

### 🔌 低优先级（锦上添花）

#### 9. 多用户支持

```
功能描述：
- 用户角色（管理员 / 普通用户）
- 操作审计日志
- 每用户独立的下载配额

技术要点：
- RBAC 权限模型
- audit_logs 表记录操作
- 用户配额检查中间件
```

#### 10. 媒体库集成

```
功能描述：
- 下载完成后调用 Plex/Emby/Jellyfin 刷新库
- 自动重命名（按 TMDB/TVDB 规范）
- 硬链接/软链接管理（保留做种的同时整理媒体库）

技术要点：
- 集成各媒体库 API
- filebot 或自定义重命名逻辑
- Node.js fs 创建硬链接
```

#### 11. Docker 健康检查与监控

```
功能描述：
- 内置 /health 端点
- Prometheus 指标导出
- Docker Compose 健康检查集成

技术要点：
- Express 健康检查路由
- prom-client 导出指标
- docker-compose healthcheck 配置
```

#### 12. 插件系统

```
功能描述：
- 允许用户自定义站点解析规则
- 可扩展的通知渠道
- 自定义自动化脚本钩子

技术要点：
- JavaScript 沙箱执行用户脚本
- 事件钩子系统（onDownloadComplete 等）
- 插件配置 UI
```

---

## 💡 Top 5 推荐实现顺序

| 排名 | 功能 | 原因 | 预估工作量 |
|------|------|------|------------|
| 🥇 | **站点数据统计页面** | PT 用户最关心分享率和贡献，可视化价值高 | 3-5 天 |
| 🥈 | **智能辅种** | PT 玩家刚需，独立开发工作量可控 | 5-7 天 |
| 🥉 | **通知增强 (Telegram)** | 移动端操控入口，用户呼声高 | 2-3 天 |
| 4️⃣ | **多站点聚合搜索** | 提升搜索效率，体验提升明显 | 3-4 天 |
| 5️⃣ | **PWA 支持** | 投入产出比高，移动端体验大幅提升 | 2-3 天 |

---

## 📋 实施建议

1. **渐进式迭代**：每次专注一个功能，完成后再开始下一个
2. **用户反馈驱动**：收集使用反馈，调整优先级
3. **保持向后兼容**：数据库迁移脚本要支持平滑升级
4. **文档同步更新**：每个新功能都要更新 README 和 API 文档

---

## 🔗 相关文档

- [日志系统指南](./logging_system_guide.md)
- [备份功能说明](./backup_functionality_update.md)
- [剧集文件组织](./series_file_organization.md)
