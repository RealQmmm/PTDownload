# 下载路径配置优化

## 修改时间
2026-01-03

## 修改内容

### 1. 优化保存按钮显示 ✅

**位置**: `client/src/pages/SettingsPage.jsx`

**修改**:
- 增加了默认下载路径保存按钮的宽度（`min-w-[80px]`）
- 将按钮文字从"保存"改为"保存路径"，更加明确

**效果**: 按钮更加醒目，用户体验更好

---

### 2. 动态路径选择逻辑 ✅

**位置**: `client/src/pages/TasksPage.jsx`

**新增状态**:
```javascript
const [defaultDownloadPath, setDefaultDownloadPath] = useState('');
const [enableMultiPath, setEnableMultiPath] = useState(false);
```

**新增功能**:
- 添加 `fetchSettings()` 函数，在组件加载时获取系统设置
- 从后端获取 `default_download_path` 和 `enable_multi_path` 配置

**路径选择逻辑**:

#### 简单模式（多路径管理关闭）
- 显示选项：
  - 📂 默认路径（用户配置的默认下载路径）
  - ✏️ 自定义路径
- 如果未配置默认路径，显示提示：
  > 💡 提示：请先在「系统设置 - 下载」中配置默认下载路径

#### 多路径管理模式（多路径管理开启）
- 显示选项：
  - 所有配置的下载路径（从 `download_paths` 表读取）
  - 默认路径会显示 ⭐ 标记
  - ✏️ 自定义路径

---

## 用户使用流程

### 场景 1: 简单使用（推荐新手）
1. 进入「系统设置 - 下载」
2. 在"默认下载路径"中输入路径，如 `/downloads`
3. 点击"保存路径"
4. 创建 RSS 任务时，选择"📂 默认路径"即可

### 场景 2: 高级使用（多路径分类）
1. 进入「系统设置 - 下载」
2. 开启"多路径管理"开关
3. 在"路径管理"中配置多个路径（电影、剧集、动画等）
4. 创建 RSS 任务时，可以从所有配置的路径中选择

---

## 技术细节

### 前端修改
- `SettingsPage.jsx`: 
  - 新增默认路径配置卡片
  - 新增多路径管理开关
  - 优化保存按钮样式

- `TasksPage.jsx`:
  - 动态获取系统设置
  - 根据 `enableMultiPath` 状态渲染不同的路径选项
  - 添加友好的提示信息

### 后端修改
- `server/src/db/index.js`:
  - 新增 `default_download_path` 配置项（默认空字符串）
  - 新增 `enable_multi_path` 配置项（默认 `false`）

---

## 优势

1. **简化新手体验**: 关闭多路径管理时，只需配置一个默认路径
2. **保持高级功能**: 开启多路径管理后，可以使用完整的分类功能
3. **渐进式增强**: 用户可以从简单模式逐步过渡到高级模式
4. **清晰的提示**: 未配置时会显示友好的提示信息
5. **视觉优化**: 保存按钮更明显，默认路径有特殊标记

---

## 测试建议

1. 测试简单模式：
   - 关闭多路径管理
   - 配置默认下载路径
   - 创建 RSS 任务，验证路径选项

2. 测试多路径模式：
   - 开启多路径管理
   - 配置多个下载路径
   - 创建 RSS 任务，验证所有路径都显示

3. 测试未配置状态：
   - 关闭多路径管理且不配置默认路径
   - 验证提示信息是否正确显示

4. 测试自定义路径：
   - 在两种模式下都测试自定义路径功能
