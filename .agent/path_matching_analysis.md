# 智能分类路径匹配问题分析

## 问题描述
用户反馈:一个纪录片种子名称里包含S01,但没有帮我选择到合适的下载路径(应该选择"剧集"路径,但可能选择了"纪录片"路径)

## 代码逻辑检查

### 当前优先级顺序(正常)
1. **类型精确匹配** - 根据PT站点的category字段精确匹配路径名称
2. **关键词评分匹配** - 根据种子名称中的关键词评分
3. **系统默认路径** - 使用标记为默认的路径
4. **下载器默认路径** - 使用下载器自身的默认目录

### 关键词匹配评分规则(可能存在问题)

#### 剧集关键词
```javascript
'剧集': ['s0', 's1', 's2', 's3', 's4', 's5', 'season', 'episode', 'ep', '剧集', '美剧', '日剧', '韩剧', '国产剧']
```
- 匹配到关键词: +10分
- 匹配到 `s\d{1,2}` 或 `season\s*\d{1,2}` 正则: 额外+5分
- **最高分数: 15分**

#### 纪录片关键词
```javascript
'纪录片': ['documentary', 'docu', 'nature', 'bbc', 'discovery', '纪录片']
```
- 匹配到关键词: +10分
- 如果路径名称在种子名称中出现: 额外+15分
- **最高分数: 25分**

### 问题根源

**评分机制存在不平衡:**

1. **路径名称直接匹配加分过高** (第93行)
   - 如果种子名称包含"纪录片"这个词,纪录片路径会额外获得15分
   - 但剧集路径即使匹配到S01,最多只能得到15分

2. **剧集特征识别不够强** (第77行)
   - 当前只对 `s\d{1,2}` 或 `season\s*\d{1,2}` 加5分
   - 但 `'s0'` 这种字符串匹配太宽泛,可能误匹配

3. **可能的实际场景:**
   ```
   种子名称: "自然纪录片 Planet Earth S01E01 2160p"
   
   剧集路径得分:
   - 匹配 's0': +10分
   - 匹配 s\d{1,2} 正则: +5分
   - 总分: 15分
   
   纪录片路径得分:
   - 匹配 '纪录片': +10分
   - 种子名称包含"纪录片": +15分
   - 总分: 25分
   
   结果: 纪录片路径胜出 ❌
   ```

## 建议修复方案

### 方案1: 提高剧集季集标识的权重
```javascript
// 如果是剧集,额外检查季数标识
if (category === '剧集' && /s\d{1,2}|season\s*\d{1,2}/i.test(name)) {
    score += 15; // 从5改为15,使剧集特征更明显
}
```

### 方案2: 降低路径名称直接匹配的权重
```javascript
// 直接名称匹配加分
if (name.includes(pathName)) {
    score += 5; // 从15改为5,避免过度影响
}
```

### 方案3: 优化剧集关键词匹配规则
```javascript
'剧集': [
    /s\d{2}/i,  // 使用正则,精确匹配S01, S02等
    /season\s*\d{1,2}/i,
    /ep?\d{2}/i,  // E01, EP01等
    '剧集', '美剧', '日剧', '韩剧', '国产剧'
]
```

### 方案4: 引入互斥规则
如果检测到明确的剧集标识(S01-S99),应该优先考虑剧集路径,即使包含其他类别关键词。

## 需要用户提供的信息

1. **具体的种子名称** - 请提供那个纪录片种子的完整名称
2. **PT站点的category字段** - 该种子在PT站点上的分类是什么?
3. **当前路径配置** - 你配置了哪些下载路径?(名称和路径)
4. **实际选择的路径** - 系统最终选择了哪个路径?

有了这些信息,我可以精确定位问题并提供针对性的修复。
